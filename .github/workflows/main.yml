name: Build Tar for Download
on: workflow_dispatch

jobs:
  bundle:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: read # Grants permission to pull from GHCR
    steps:
      - name: Log in to GHCR
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

      - name: Pull and Save Image
        run: |
          docker pull ghcr.io/bytebot-ai/bytebot-desktop:latest
          docker save ghcr.io/bytebot-ai/bytebot-desktop:latest -o bytebot-desktop.tar

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: bytebot-image-tar
          path: bytebot-desktop.tar
          compression-level: 0 # Faster upload for large binary files
